graph:
  based_on: graph

  select:
    graph_group: graph_data

  # Configure the created networkx graph object
  graph_creation:
    at_time_idx: -1                           # Select the last timestep
    node_props: ['degree']  # Select node and edge
    #edge_props: ['weights']                   # properties from the GraphGroup

  # Configure the graph layout
  graph_drawing:

    positions:
      model: spring                   # The spring model positions the nodes
                                      # such that edge lengths are reduced.
      k: 1                          # Tweaking the spring model by adjusting
                                      # the optimal edge length (k) and the
      iterations: 50               # maximum number of iterations done.
    nodes:
      node_color:
       from_property: degree     # Map the 'some_state' data to the color
      node_size:
        from_property: degree         # Map the node degree to the node size
        scale_to_interval: [10, 30]  # Scale the (degree-)data to the given
                                    #  interval (the default size is 300).
    edges:
      width: 0.2
        #from_property: weights        # Map the 'weights' data to the edge
        #scale_to_interval: [0.1, 1.2] # width and scale the data accordingly.
      alpha: 0.2

  helpers:
    set_title:
      title: Graph topology

nw_stats:
  based_on: network_stats
  bins: 100
  helpers:
    set_scales:
      x: log
      y: log
  color: black

nw_stats_sweep:
  based_on: multiverse.errorbars
  select_and_combine:
    fields:
      mu:
        path: cfg/NetworkAnalyser
      param:
        path: data/KronGen/NetworkAnalyser/graph_data/clustering_coeff
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1

  transform:
    - operation: .mean
      args: [!dag_tag param]
      kwargs:
        dim: vertex_idx
      tag: means
    - operation: .std
      args: [!dag_tag param]
      kwargs:
        dim: vertex_idx
        ddof: 1
      tag: stds
    - operation: xr.Dataset
      kwargs:
        data_vars:
          D: !dag_tag means
          dD: !dag_tag stds
      tag: data

  x: mu
  y: D
  yerr: dD
  capsize: 2
  elinewidth: 1
  marker: o
  helpers:
    set_title:
      title: Clustering
    set_labels:
      x: p_rewire
      y: avg c
    set_scales:
      y: linear

clustering_glob:
  based_on: sweep_stats
  select_and_combine:
    fields:
      clustering_coeff:
        path: cfg/NetworkAnalyser
      c:
        path: data/KronGen/NetworkAnalyser/graph_data/clustering_global
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1

  transform:
    - operation: .isel
      args: [!dag_tag c]
      tag: data

  helpers:
    set_title:
      title: Network clustering coefficient (global)
    set_labels:
      x: clustering coefficient (in)
      y: clustering coefficient (out)
    set_limits:
      x: [0, 1]
      y: [0, 1]

num_vertices:
  based_on: sweep_stats
  select_and_combine:
    fields:
      clustering_coeff:
        cfg/NetworkAnalyser
      N:
        path: data/KronGen/NetworkAnalyser/graph_data/_vertices
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              vertex_idx: -1

  transform:
    - operation: .isel
      args: [!dag_tag N]
      tag: data
  helpers:
    set_title:
      title: Number of vertices
    set_labels:
      x: clustering coefficient (in)
      y: number of vertices

diameter:
  based_on: sweep_stats
  select_and_combine:
    fields:
      x:
        path: cfg/NetworkAnalyser
      diameter:
        path: data/KronGen/NetworkAnalyser/graph_data/diameter
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1


  transform:
    - operation: .isel
      args: [!dag_tag diameter]
      tag: data

  helpers:
    set_title:
      title: Network diameter
    set_labels:
      x: sweep parameter
      y: diameter
