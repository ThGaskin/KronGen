# ... Plot anchors .............................................................
_:
  sweep_parameter: &sweep_param
    select_and_combine:
      fields:
        clustering:
          path: cfg/NetworkAnalyser
  x_coord: &x_coord
    x: clustering
  x_label: &x_label
    x: Target
    y: Output

# ... Clustering over sweep parameter ..........................................
clustering:
  based_on: clustering_target
  <<: [*sweep_param, *x_coord]
  compute_only: [save_data, data]
  helpers:
    set_labels:
      <<: *x_label

c_err:
  based_on: error_bar_plot
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/clustering_global
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
  helpers:
    set_title:
      title: Clustering coefficient
    set_labels:
      <<: *x_label
      y: Number of vertices
    set_limits:
      x: [0, 1]
      y: [0, 1]

d_err:
  based_on: error_bar_plot
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/diameter
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
  helpers:
    set_title:
      title: Diameter
    set_labels:
      <<: *x_label
      y: Number of vertices
    set_limits:
      x: [0, 1]


N_err:
  based_on: error_bar_plot
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/_vertices
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              vertex_idx: -1
          - add: [!dag_prev , 1]
k_err:
  based_on: error_bar_plot
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/degree
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
          - .mean: [!dag_prev , vertex_idx]

# ... Graph mean degree ........................................................
mean_degree:
  based_on: mean_degree
  <<: [*sweep_param, *x_coord]
  compute_only: [save_data, data]
  helpers:
    set_labels:
      <<: *x_label

# ... Graph num vertices .......................................................
num_vertices:
  based_on: num_vertices
  <<: [*sweep_param, *x_coord]
  compute_only: [save_data, data]
  helpers:
    set_labels:
      <<: *x_label

# ... Graph diameter ...........................................................
diameter:
  based_on: diameter
  <<: [*sweep_param, *x_coord]
  compute_only: [save_data, data]
  helpers:
    set_labels:
      <<: *x_label

# ... Optimisation error .......................................................
error:
  based_on: sweep_stats
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/optimisation_error
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
  transform:
    - operation: .isel
      args: [!dag_tag data_val]
      tag: data
    - operation: save_data
      args: [!dag_tag data_val, !dag_tag out_dir]
      tag: save_data
  compute_only: [save_data, data]
  helpers:
    set_title:
      title: Optimisation error $H$
    set_labels:
      x: Target parameter
      y: Error

# ... Size of largest factor .......................................................
largest_factor:
  based_on: sweep_stats
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/largest_comp
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
  transform:
    - operation: .isel
      args: [!dag_tag data_val]
      tag: data
    - operation: save_data
      args: [!dag_tag data_val, !dag_tag out_dir]
      tag: save_data
  compute_only: [save_data, data]
  helpers:
    set_title:
      title: Largest factor size
    set_labels:
      x: Target parameter
      y: $d$

# ... Number of factors .......................................................
n_factors:
  based_on: sweep_stats
  select_and_combine:
    fields:
      data_val:
        path: data/KronGen/NetworkAnalyser/graph_data/n_factors
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1
  transform:
    - operation: .isel
      args: [!dag_tag data_val]
      tag: data
    - operation: save_data
      args: [!dag_tag data_val, !dag_tag out_dir]
      tag: save_data
  compute_only: [save_data, data]
  helpers:
    set_title:
      title: Number of Kronecker factors $d$
    set_labels:
      x: Target parameter
      y: $d$

# ... Graph plot ...............................................................
graph:
  based_on: graph
  enabled: false

# ... Network statistics .......................................................
nw_stats:
  based_on: nw_stats


# ... Diameter estimate coefficient ............................................
diameter_coeff:
  based_on: diameter_coeff
