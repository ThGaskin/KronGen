graph:
  based_on: graph

  select:
    graph_group: graph_data

  # Configure the created networkx graph object
  graph_creation:
    at_time_idx: -1                           # Select the last timestep
    node_props: ['degree']  # Select node and edge
    # edge_props: ['weights']                   # properties from the GraphGroup

  # Configure the graph layout
  graph_drawing:

    positions:
      model: spring                   # The spring model positions the nodes
                                      # such that edge lengths are reduced.
      k: 1                            # Tweaking the spring model by adjusting
                                      # the optimal edge length (k) and the
      iterations: 100                 # maximum number of iterations done.
    nodes:
      node_color:
        from_property: degree     # Map the 'some_state' data to the color
      node_size:
        from_property: degree         # Map the node degree to the node size
        scale_to_interval: [10, 200]  # Scale the (degree-)data to the given
                                      # interval (the default size is 300).
    edges:
      width: 0.2
        # from_property: weights        # Map the 'weights' data to the edge
        # scale_to_interval: [0.1, 1.2] # width and scale the data accordingly.

  helpers:
    set_title:
      title: Final Graph

nw_stats:
  based_on: network_stats
  #range: [-1000, 1000]
  bins: 100
  helpers:
    set_scales:
      x: log
      y: log

nw_stats_sweep:
  based_on: multiverse.errorbars
  select_and_combine:
    fields:
      p_rewire:
        path: cfg/NetworkAnalyser
      param:
        path: data/KronGen/NetworkAnalyser/graph_data/distance_max
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1

  transform:
    - operation: .max
      args: [!dag_tag param]
      kwargs:
        dim: vertex_idx
      tag: means
    - operation: .std
      args: [!dag_tag param]
      kwargs:
        dim: vertex_idx
        ddof: 1
      tag: stds
    - operation: xr.Dataset
      kwargs:
        data_vars:
          D: !dag_tag means
          dD: !dag_tag stds
      tag: data

  x: p_rewire
  y: D
  yerr: dD
  capsize: 2
  elinewidth: 1
  marker: o
  helpers:
    set_title:
      title: Maximum distance
    set_labels:
      x: p_rewire
      y: avg shortest path distance
    set_scales:
      y: log

diameter:
  based_on: .dag.generic.facet_grid
  creator: multiverse
  kind: line
  select_and_combine:
    fields:
      p_rewire:
        path: cfg/NetworkAnalyser
      diameter:
        path: data/KronGen/NetworkAnalyser/graph_data/diameter
        transform:
          - operation: .isel
            args: [!dag_prev ]
            kwargs:
              time: -1

  transform:
    - operation: .isel
      args: [!dag_tag diameter]
      tag: data

  helpers:
    set_title:
      title: Network diameter
    set_labels:
      x: p_rewire
      y: diameter
